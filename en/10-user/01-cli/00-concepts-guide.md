# WarpParse Core Concepts Quick Reference

This document helps beginners quickly understand WarpParse's core concepts and terminology.

## What is ETL?

ETL stands for Extract, Transform, and Load. Simply put:

- **Extract**: Read raw data from log files, databases, message queues, etc.
- **Transform**: Convert unstructured text into structured data (e.g., JSON)
- **Load**: Store processed data to target destinations (files, databases, ES, etc.)

### Analogy

Think of it like a smart package sorting system:
- **Extract** = Collection (gathering packages from various locations)
- **Transform** = Classification (sorting by address, type, and labeling)
- **Load** = Delivery (sending to corresponding destinations)

---

## WarpParse Core Terminology

| Term | Chinese | Plain Explanation | Analogy |
|------|---------|-------------------|---------|
| **Source** | 源 | Where data comes from | Water source (file, TCP, Kafka) |
| **Sink** | 汇 | Where data goes to | Water tank (file, database, ES) |
| **Connector** | 连接器 | How to connect to data sources/targets | Pipe connector (connection parameters) |
| **WPL** | Warp Processing Language | Data extraction rule language | Sieve (defines how to extract fields from text) |
| **OML** | Object Modeling Language | Data assembly rule language | Mold (defines how to assemble target format) |
| **Rule** | 规则 | A parsing rule | A sieve blueprint |
| **Field** | 字段 | Data item to extract | A hole in the sieve |
| **Pipe** | 管道 | Data processing flow | Water pipe (data flow path) |

---

## Data Flow Process

```
Raw Logs → [Source Read] → [WPL Parse] → [OML Transform] → [Sink Output] → Target Storage
    ↓            ↓              ↓               ↓                ↓
File/TCP     connectors    Extract Fields   Assemble Objects   File/DB/ES
```

### Detailed Explanation

1. **Source Read**: Read raw data from configured data sources
   - File: Read log files
   - TCP: Listen on network ports to receive data
   - Kafka: Consume data from message queues

2. **WPL Parse**: Use WPL rules to extract fields from raw text
   - Identify IP addresses, timestamps, numbers, etc.
   - Parse structured data like JSON, KV
   - Validate and filter fields

3. **OML Transform**: Use OML rules to assemble output format
   - Field renaming and mapping
   - Type conversion (string → number → time)
   - Conditional logic and calculations

4. **Sink Output**: Write processed data to targets
   - File: Save as JSON/CSV formats
   - Database: Write to MySQL/PostgreSQL
   - Search Engine: Write to Elasticsearch

---

## Quick Start Path

### Stage 1:
1. Complete Getting Started to see data flow in action
2. Learn WPL basic types (ip, digit, time, chars)
3. Learn OML data assembly
4. Explore demo examples in the editor

### Stage 2:
1. Complete T1 exercise in the editor
2. Create your own WPL and OML in your workspace
3. Configure Source and Sink
4. Use wpgen to generate sample data, wparse to execute and view output

---

## Project Directory Structure

```
workspace/
├── conf/              # Configuration files
│   ├── wparse.toml   # Parse engine config
│   └── wpgen.toml    # Data generator config
│
├── connectors/        # Connector definitions
│   ├── sink.d/       # Output connectors (where data goes)
│   └── source.d/     # Input connectors (where data comes from)
│
├── data/              # Data directory
│   ├── in_dat/       # Input data (raw logs)
│   │   └── gen.dat  # Generated test data
│   ├── out_dat/      # Output data (parsed results)
│   │   ├── demo.json       # All successfully parsed records
│   │   ├── default.dat     # WPL matched but OML unmatched data
│   │   ├── error.dat       # Error data
│   │   ├── miss.dat        # WPL unmatched data
│   │   ├── monitor.dat     # Monitoring data
│   │   └── residue.dat     # Residual data (partially parsed)
│   ├── logs/         # Runtime logs
│   └── rescue/       # Failed data (for troubleshooting)
│
├── models/            # Model definitions
│   ├── wpl/          # WPL parsing rules
│   │   └── wp-space/
│   │       ├── parse.wpl    # Parsing rule file
│   │       └── sample.dat   # Test samples for rules
│   ├── oml/          # OML transformation rules
│   │   └── wp-space/
│   │       └── adm.oml      # Object mapping rules
│   └── knowledge/    # Knowledge base (SQL queries, etc.)
│
└── topology/          # Topology configuration
    ├── sources/      # Data source config
    └── sinks/        # Data target config
```

### Directory Explanation

- **conf/**: Global configuration like log level, performance parameters
- **connectors/**: Define how to connect to data sources and targets
- **data/**: Storage location for all data files
  - **in_dat/**: Store raw input data
    - `gen.dat`: Test data generated by wpgen
  - **out_dat/**: Store parsed output data
    - `all.json`: All successfully parsed records (JSON format)
    - `default.dat`: Data that matched WPL but not OML
    - `error.dat`: Records that encountered errors during parsing
    - `miss.dat`: Records that didn't match WPL rules
    - `monitor.dat`: Monitoring and statistics data
    - `residue.dat`: Residual data with partially parsed fields
  - **logs/**: Runtime logs for debugging and troubleshooting
  - **rescue/**: Failed raw data for reprocessing
- **models/**: Core business logic (WPL rules and OML rules)
  - **wpl/**: WPL parsing rules, organized by namespace
    - `wp-space/parse.wpl`: Specific parsing rule file
    - `wp-space/sample.dat`: Test samples for the rules
  - **oml/**: OML transformation rules, organized by namespace
    - `wp-space/adm.oml`: Object mapping and transformation rules
  - **knowledge/**: Knowledge base like SQL queries, IP databases, etc.
- **topology/**: Data flow topology configuration

---

## Common Commands Quick Reference

| Command | Function | Example |
|---------|----------|---------|
| `wproj init` | Initialize project | `wproj init --mode full` |
| `wproj check` | Check configuration | `wproj check` |
| `wproj data stat` | Statistics | `wproj data stat` |
| `wpgen sample` | Generate test data | `wpgen sample -n 3000` |
| `wparse batch` | Batch processing mode | `wparse batch --stat 3 -p` |
| `wparse daemon` | Daemon mode | `wparse daemon --stat-print` |
| `wprescue batch` | Recover failed data | `wprescue batch` |

---

## Next Steps

After reading this document, we recommend learning in the following order:

1. **[Getting Started](./01-cli/01-getting_started.md)**: Run your first example in 10 minutes
2. **[WPL Language Basics](./03-wpl/01-wpl_basics.md)**: Learn data extraction rules
3. **[OML Language Basics](./04-oml/README.md)**: Learn data assembly rules

---

## Related Documentation

- [Getting Started](./01-cli/01-getting_started.md)
- [CLI Tools](./01-cli/README.md)
- [WPL Language](./03-wpl/README.md)
- [OML Language](./04-oml/README.md)
